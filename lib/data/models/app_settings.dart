import 'package:hive/hive.dart';

part 'app_settings.g.dart'; // Will be generated by build_runner

@HiveType(
    typeId:
        2) // Using typeId 2, assuming ComparisonSession is 1 (or other unused ID)
class AppSettings extends HiveObject {
  @HiveField(0, defaultValue: 'Auto')
  String defaultSourceFormat;

  @HiveField(1, defaultValue: 'Auto')
  String defaultTargetFormat;

  @HiveField(2, defaultValue: ['^//.*', '^#.*'])
  List<String> ignorePatterns;

  @HiveField(3, defaultValue: true)
  bool ignoreCase;

  @HiveField(4, defaultValue: false)
  bool ignoreWhitespace;

  @HiveField(5, defaultValue: 'English (US)')
  String appLanguage;

  @HiveField(6, defaultValue: 'Basic Comparison')
  String defaultViewOnStartup;

  @HiveField(7, defaultValue: true)
  bool autoCheckForUpdates;

  @HiveField(8, defaultValue: 'System')
  String appThemeMode;

  @HiveField(9, defaultValue: 0xFF7B61FF)
  int accentColorValue;

  @HiveField(10, defaultValue: 0xFF4CAF50)
  int diffAddedColor;

  @HiveField(11, defaultValue: 0xFFF44336)
  int diffRemovedColor;

  @HiveField(12, defaultValue: 0xFFFFC107)
  int diffModifiedColor;

  @HiveField(37, defaultValue: 14.0)
  double diffFontSize;

  @HiveField(13, defaultValue: 'UTF-8')
  String defaultSourceEncoding;

  @HiveField(14, defaultValue: 'UTF-8')
  String defaultTargetEncoding;

  @HiveField(15, defaultValue: true)
  bool autoDetectEncoding;

  @HiveField(16, defaultValue: ',')
  String csvDelimiter;

  @HiveField(17, defaultValue: true)
  bool handleByteOrderMark;

  @HiveField(18, defaultValue: true)
  bool autoReloadOnChange;

  @HiveField(19, defaultValue: '')
  String defaultExportDirectory;

  // AI Services Settings
  @HiveField(20, defaultValue: 'Google Translate')
  String aiTranslationService;

  @HiveField(21, defaultValue: '')
  String googleTranslateApiKey;

  @HiveField(22, defaultValue: '')
  String deeplApiKey;

  @HiveField(23, defaultValue: false)
  bool enableAiTranslation;

  @HiveField(24, defaultValue: 0.8)
  double translationConfidenceThreshold;

  // LLM Translation Settings
  @HiveField(30, defaultValue: '')
  String geminiApiKey;

  @HiveField(31, defaultValue: '')
  String openaiApiKey;

  @HiveField(32, defaultValue: '')
  String defaultAiModel;

  @HiveField(33, defaultValue: '')
  String systemTranslationContext;

  @HiveField(34, defaultValue: 2)
  int contextStringsCount;

  @HiveField(35, defaultValue: false)
  bool includeContextStrings;

  @HiveField(58, defaultValue: true)
  bool enableTranslationMemory;

  @HiveField(59, defaultValue: true)
  bool enableFuzzyFill;

  @HiveField(60, defaultValue: 0.6)
  double fuzzyFillMinScore;

  @HiveField(61, defaultValue: false)
  bool fuzzyFillAutoApply;

  @HiveField(62, defaultValue: true)
  bool fuzzyFillOnlyEmptyTargets;

  @HiveField(63, defaultValue: 3)
  int fuzzyFillMatchLimit;

  @HiveField(64, defaultValue: false)
  bool fuzzyFillExactMatchesOnly;

  // Version Control Settings
  @HiveField(25, defaultValue: '')
  String defaultGitRepositoryPath;

  @HiveField(26, defaultValue: false)
  bool autoCommitOnSave;

  @HiveField(27, defaultValue: '')
  String gitUserName;

  @HiveField(28, defaultValue: '')
  String gitUserEmail;

  @HiveField(29, defaultValue: false)
  bool enableGitIntegration;

  @HiveField(65, defaultValue: 'main')
  String defaultBranch;

  @HiveField(66, defaultValue: 'origin')
  String defaultRemote;

  @HiveField(67, defaultValue: 'Update localization: {files}')
  String commitMessageTemplate;

  @HiveField(68, defaultValue: '')
  String sshKeyPath;

  @HiveField(36, defaultValue: true)
  bool showIdenticalEntries;

  // Startup Options
  @HiveField(38, defaultValue: false)
  bool startMinimizedToTray;

  @HiveField(39, defaultValue: false)
  bool openLastProjectOnStartup;

  @HiveField(40, defaultValue: false)
  bool rememberWindowPosition;

  @HiveField(41)
  double? lastWindowX;

  @HiveField(42)
  double? lastWindowY;

  @HiveField(43)
  double? lastWindowWidth;

  @HiveField(44)
  double? lastWindowHeight;

  // Comparison Engine - Similarity Threshold
  @HiveField(45, defaultValue: 0.85)
  double similarityThreshold;

  // AI Model Parameters
  @HiveField(56, defaultValue: 0.7)
  double aiTemperature;

  @HiveField(57, defaultValue: 2048)
  int maxTokens;

  // Comparison Engine - Comparison Mode
  @HiveField(46, defaultValue: 'Key-based')
  String comparisonMode;

  // Windows Integration Settings
  @HiveField(47, defaultValue: false)
  bool useMicaEffect;

  // Diff Font Family
  @HiveField(48, defaultValue: 'System Default')
  String diffFontFamily;

  // Identical Entry Color
  @HiveField(49, defaultValue: 0xFF9E9E9E)
  int diffIdenticalColor;

  // Export Settings
  @HiveField(50, defaultValue: 'CSV')
  String defaultExportFormat;

  @HiveField(51, defaultValue: true)
  bool includeUtf8Bom;

  @HiveField(52, defaultValue: true)
  bool openFolderAfterExport;

  // Backup Settings
  @HiveField(53, defaultValue: true)
  bool autoBackup;

  @HiveField(54, defaultValue: '')
  String backupDirectory;

  @HiveField(55, defaultValue: 5)
  int backupsToKeep;

  // Update Settings
  @HiveField(69, defaultValue: false)
  bool autoDownloadUpdate;

  @HiveField(70)
  String? lastUpdateCheckTime;

  @HiveField(71, defaultValue: '')
  String skipVersion;

  // Telemetry Settings
  // TODO: Integrate Firebase Analytics for anonymous usage statistics
  // TODO: Integrate Firebase Crashlytics for crash reporting
  // These settings currently only store user preferences - no data is collected yet
  @HiveField(72, defaultValue: false)
  bool enableAnonymousUsageStatistics;

  @HiveField(73, defaultValue: true)
  bool enableCrashReporting;

  // Developer Options
  @HiveField(74, defaultValue: false)
  bool showDeveloperOptions;

  @HiveField(84, defaultValue: false)
  bool showPerformanceOverlay;

  @HiveField(85, defaultValue: false)
  bool showSemanticsDebugger;

  @HiveField(86, defaultValue: false)
  bool debugShowMaterialGrid;

  @HiveField(87, defaultValue: false)
  bool checkerboardRasterCacheImages;

  @HiveField(88, defaultValue: false)
  bool checkerboardOffscreenLayers;

  @HiveField(89, defaultValue: false)
  bool debugPaintSizeEnabled;

  @HiveField(90, defaultValue: false)
  bool debugRepaintRainbowEnabled;

  // macOS Integration Settings
  @HiveField(75, defaultValue: false)
  bool showDockBadge;

  @HiveField(76, defaultValue: 'sidebar')
  String macosWindowMaterial;

  @HiveField(77, defaultValue: 'llm')
  String translationStrategy;

  @HiveField(78, defaultValue: [])
  List<String> recentProjects;

  @HiveField(79, defaultValue: 'BottomRight')
  String toastPosition;

  @HiveField(80, defaultValue: 'Compact')
  String toastStyle;

  @HiveField(81, defaultValue: false)
  bool advancedDiffUseInlineEditing;

  @HiveField(82, defaultValue: 0)
  int onboardingStep;

  @HiveField(83, defaultValue: false)
  bool isOnboardingCompleted;

  // Extended Developer Tools
  @HiveField(91, defaultValue: false)
  bool showLocalizationKeys;

  AppSettings({
    required this.defaultSourceFormat,
    required this.defaultTargetFormat,
    required this.ignorePatterns,
    required this.ignoreCase,
    required this.ignoreWhitespace,
    required this.appLanguage,
    required this.defaultViewOnStartup,
    required this.autoCheckForUpdates,
    required this.appThemeMode,
    required this.accentColorValue,
    required this.diffAddedColor,
    required this.diffRemovedColor,
    required this.diffModifiedColor,
    required this.diffFontSize,
    required this.defaultSourceEncoding,
    required this.defaultTargetEncoding,
    required this.autoDetectEncoding,
    required this.csvDelimiter,
    required this.handleByteOrderMark,
    required this.autoReloadOnChange,
    required this.defaultExportDirectory,
    required this.aiTranslationService,
    required this.googleTranslateApiKey,
    required this.deeplApiKey,
    required this.enableAiTranslation,
    required this.translationConfidenceThreshold,
    required this.geminiApiKey,
    required this.openaiApiKey,
    required this.defaultAiModel,
    required this.systemTranslationContext,
    required this.contextStringsCount,
    required this.includeContextStrings,
    required this.enableTranslationMemory,
    required this.enableFuzzyFill,
    required this.fuzzyFillMinScore,
    required this.fuzzyFillAutoApply,
    required this.fuzzyFillOnlyEmptyTargets,
    required this.fuzzyFillMatchLimit,
    required this.fuzzyFillExactMatchesOnly,
    required this.defaultGitRepositoryPath,
    required this.autoCommitOnSave,
    required this.gitUserName,
    required this.gitUserEmail,
    required this.enableGitIntegration,
    required this.defaultBranch,
    required this.defaultRemote,
    required this.commitMessageTemplate,
    required this.sshKeyPath,
    required this.showIdenticalEntries,
    required this.startMinimizedToTray,
    required this.openLastProjectOnStartup,
    required this.rememberWindowPosition,
    this.lastWindowX,
    this.lastWindowY,
    this.lastWindowWidth,
    this.lastWindowHeight,
    required this.similarityThreshold,
    required this.aiTemperature,
    required this.maxTokens,
    required this.comparisonMode,
    required this.useMicaEffect,
    required this.diffFontFamily,
    required this.diffIdenticalColor,
    required this.defaultExportFormat,
    required this.includeUtf8Bom,
    required this.openFolderAfterExport,
    required this.autoBackup,
    required this.backupDirectory,
    required this.backupsToKeep,
    required this.autoDownloadUpdate,
    this.lastUpdateCheckTime,
    required this.skipVersion,
    required this.enableAnonymousUsageStatistics,
    required this.enableCrashReporting,
    required this.showDeveloperOptions,
    required this.showPerformanceOverlay,
    required this.showSemanticsDebugger,
    required this.debugShowMaterialGrid,
    required this.checkerboardRasterCacheImages,
    required this.checkerboardOffscreenLayers,
    required this.debugPaintSizeEnabled,
    required this.debugRepaintRainbowEnabled,
    required this.showDockBadge,
    required this.macosWindowMaterial,
    required this.translationStrategy,
    required this.recentProjects,
    required this.toastPosition,
    required this.toastStyle,
    required this.advancedDiffUseInlineEditing,
    required this.onboardingStep,
    required this.isOnboardingCompleted,
    required this.showLocalizationKeys,
  });

  // Default settings
  factory AppSettings.defaultSettings() {
    return AppSettings(
      defaultSourceFormat: 'Auto',
      defaultTargetFormat: 'Auto',
      ignorePatterns: ['^//.*', '^#.*'],
      ignoreCase: true,
      ignoreWhitespace: false,
      appLanguage: 'Auto-Detect', // Default for new field
      defaultViewOnStartup: 'Basic Comparison', // Default for new field
      autoCheckForUpdates: true, // Default for new field
      appThemeMode: 'System', // Default for new field
      accentColorValue:
          0xFF7B61FF, // Default for new field (Color(0xFF7B61FF).value)
      diffAddedColor: 0xFF4CAF50, // Material Green
      diffRemovedColor: 0xFFF44336, // Material Red
      diffModifiedColor: 0xFFFFC107, // Material Amber
      diffFontSize: 14.0, // Default font size
      defaultSourceEncoding: 'UTF-8',
      defaultTargetEncoding: 'UTF-8',
      autoDetectEncoding: true,
      csvDelimiter: ',',
      handleByteOrderMark: true,
      autoReloadOnChange: true,
      defaultExportDirectory: '',
      aiTranslationService: 'Google Translate',
      googleTranslateApiKey: '',
      deeplApiKey: '',
      enableAiTranslation: false,
      translationConfidenceThreshold: 0.8,
      geminiApiKey: '',
      openaiApiKey: '',
      defaultAiModel: '',
      systemTranslationContext: '',
      contextStringsCount: 2,
      includeContextStrings: false,
      enableTranslationMemory: true,
      enableFuzzyFill: true,
      fuzzyFillMinScore: 0.6,
      fuzzyFillAutoApply: false,
      fuzzyFillOnlyEmptyTargets: true,
      fuzzyFillMatchLimit: 3,
      fuzzyFillExactMatchesOnly: false,
      defaultGitRepositoryPath: '',
      autoCommitOnSave: false,
      gitUserName: '',
      gitUserEmail: '',
      enableGitIntegration: false,
      defaultBranch: 'main',
      defaultRemote: 'origin',
      commitMessageTemplate: 'Update localization: {files}',
      sshKeyPath: '',
      showIdenticalEntries: true,
      startMinimizedToTray: false,
      openLastProjectOnStartup: false,
      rememberWindowPosition: false,
      lastWindowX: null,
      lastWindowY: null,
      lastWindowWidth: null,
      lastWindowHeight: null,
      similarityThreshold: 0.85,
      aiTemperature: 0.7,
      maxTokens: 2048,
      comparisonMode: 'Key-based',
      useMicaEffect: false,
      diffFontFamily: 'System Default',
      diffIdenticalColor: 0xFF9E9E9E, // Subtle gray
      defaultExportFormat: 'CSV',
      includeUtf8Bom: true,
      openFolderAfterExport: true,
      autoBackup: true,
      backupDirectory: '',
      backupsToKeep: 5,
      autoDownloadUpdate: false,
      lastUpdateCheckTime: null,
      skipVersion: '',
      enableAnonymousUsageStatistics: false,
      enableCrashReporting: true,
      showDeveloperOptions: false,
      showPerformanceOverlay: false,
      showSemanticsDebugger: false,
      debugShowMaterialGrid: false,
      checkerboardRasterCacheImages: false,
      checkerboardOffscreenLayers: false,
      debugPaintSizeEnabled: false,
      debugRepaintRainbowEnabled: false,
      showDockBadge: false,
      macosWindowMaterial: 'sidebar',
      translationStrategy: 'llm',
      recentProjects: [],
      toastPosition: 'BottomRight',
      toastStyle: 'Compact',
      advancedDiffUseInlineEditing: false,
      onboardingStep: 0,
      isOnboardingCompleted: false,
      showLocalizationKeys: false,
    );
  }

  // From JSON
  factory AppSettings.fromJson(Map<String, dynamic> json) {
    final defaults = AppSettings.defaultSettings();

    String _readString(String key, String fallback) {
      final value = json[key];
      if (value is String) {
        return value;
      }
      return fallback;
    }

    String? _readNullableString(String key, String? fallback) {
      final value = json[key];
      if (value is String) {
        return value;
      }
      return fallback;
    }

    bool _readBool(String key, bool fallback) {
      final value = json[key];
      if (value is bool) {
        return value;
      }
      return fallback;
    }

    int _readInt(String key, int fallback) {
      final value = json[key];
      if (value is int) {
        return value;
      }
      if (value is num) {
        return value.toInt();
      }
      return fallback;
    }

    double _readDouble(String key, double fallback) {
      final value = json[key];
      if (value is num) {
        return value.toDouble();
      }
      return fallback;
    }

    double? _readOptionalDouble(String key) {
      final value = json[key];
      if (value is num) {
        return value.toDouble();
      }
      return null;
    }

    List<String> _readStringList(String key, List<String> fallback) {
      final value = json[key];
      if (value is List) {
        return value.map((item) => item.toString()).toList();
      }
      return fallback;
    }

    return AppSettings(
      defaultSourceFormat: _readString(
        'defaultSourceFormat',
        defaults.defaultSourceFormat,
      ),
      defaultTargetFormat: _readString(
        'defaultTargetFormat',
        defaults.defaultTargetFormat,
      ),
      ignorePatterns:
          _readStringList('ignorePatterns', defaults.ignorePatterns),
      ignoreCase: _readBool('ignoreCase', defaults.ignoreCase),
      ignoreWhitespace:
          _readBool('ignoreWhitespace', defaults.ignoreWhitespace),
      appLanguage: _readString('appLanguage', defaults.appLanguage),
      defaultViewOnStartup: _readString(
        'defaultViewOnStartup',
        defaults.defaultViewOnStartup,
      ),
      autoCheckForUpdates:
          _readBool('autoCheckForUpdates', defaults.autoCheckForUpdates),
      appThemeMode: _readString('appThemeMode', defaults.appThemeMode),
      accentColorValue: _readInt('accentColorValue', defaults.accentColorValue),
      diffAddedColor: _readInt('diffAddedColor', defaults.diffAddedColor),
      diffRemovedColor: _readInt('diffRemovedColor', defaults.diffRemovedColor),
      diffModifiedColor:
          _readInt('diffModifiedColor', defaults.diffModifiedColor),
      diffFontSize: _readDouble('diffFontSize', defaults.diffFontSize),
      defaultSourceEncoding: _readString(
        'defaultSourceEncoding',
        defaults.defaultSourceEncoding,
      ),
      defaultTargetEncoding: _readString(
        'defaultTargetEncoding',
        defaults.defaultTargetEncoding,
      ),
      autoDetectEncoding:
          _readBool('autoDetectEncoding', defaults.autoDetectEncoding),
      csvDelimiter: _readString('csvDelimiter', defaults.csvDelimiter),
      handleByteOrderMark:
          _readBool('handleByteOrderMark', defaults.handleByteOrderMark),
      autoReloadOnChange:
          _readBool('autoReloadOnChange', defaults.autoReloadOnChange),
      defaultExportDirectory: _readString(
        'defaultExportDirectory',
        defaults.defaultExportDirectory,
      ),
      aiTranslationService:
          _readString('aiTranslationService', defaults.aiTranslationService),
      googleTranslateApiKey: _readString(
        'googleTranslateApiKey',
        defaults.googleTranslateApiKey,
      ),
      deeplApiKey: _readString('deeplApiKey', defaults.deeplApiKey),
      enableAiTranslation:
          _readBool('enableAiTranslation', defaults.enableAiTranslation),
      translationConfidenceThreshold: _readDouble(
        'translationConfidenceThreshold',
        defaults.translationConfidenceThreshold,
      ),
      geminiApiKey: _readString('geminiApiKey', defaults.geminiApiKey),
      openaiApiKey: _readString('openaiApiKey', defaults.openaiApiKey),
      defaultAiModel: _readString('defaultAiModel', defaults.defaultAiModel),
      systemTranslationContext: _readString(
        'systemTranslationContext',
        defaults.systemTranslationContext,
      ),
      contextStringsCount:
          _readInt('contextStringsCount', defaults.contextStringsCount),
      includeContextStrings: _readBool(
        'includeContextStrings',
        defaults.includeContextStrings,
      ),
      enableTranslationMemory: _readBool(
        'enableTranslationMemory',
        defaults.enableTranslationMemory,
      ),
      enableFuzzyFill: _readBool('enableFuzzyFill', defaults.enableFuzzyFill),
      fuzzyFillMinScore:
          _readDouble('fuzzyFillMinScore', defaults.fuzzyFillMinScore),
      fuzzyFillAutoApply: _readBool(
        'fuzzyFillAutoApply',
        defaults.fuzzyFillAutoApply,
      ),
      fuzzyFillOnlyEmptyTargets: _readBool(
        'fuzzyFillOnlyEmptyTargets',
        defaults.fuzzyFillOnlyEmptyTargets,
      ),
      fuzzyFillMatchLimit:
          _readInt('fuzzyFillMatchLimit', defaults.fuzzyFillMatchLimit),
      fuzzyFillExactMatchesOnly: _readBool(
        'fuzzyFillExactMatchesOnly',
        defaults.fuzzyFillExactMatchesOnly,
      ),
      defaultGitRepositoryPath: _readString(
        'defaultGitRepositoryPath',
        defaults.defaultGitRepositoryPath,
      ),
      autoCommitOnSave:
          _readBool('autoCommitOnSave', defaults.autoCommitOnSave),
      gitUserName: _readString('gitUserName', defaults.gitUserName),
      gitUserEmail: _readString('gitUserEmail', defaults.gitUserEmail),
      enableGitIntegration:
          _readBool('enableGitIntegration', defaults.enableGitIntegration),
      defaultBranch: _readString('defaultBranch', defaults.defaultBranch),
      defaultRemote: _readString('defaultRemote', defaults.defaultRemote),
      commitMessageTemplate: _readString(
        'commitMessageTemplate',
        defaults.commitMessageTemplate,
      ),
      sshKeyPath: _readString('sshKeyPath', defaults.sshKeyPath),
      showIdenticalEntries:
          _readBool('showIdenticalEntries', defaults.showIdenticalEntries),
      startMinimizedToTray:
          _readBool('startMinimizedToTray', defaults.startMinimizedToTray),
      openLastProjectOnStartup: _readBool(
        'openLastProjectOnStartup',
        defaults.openLastProjectOnStartup,
      ),
      rememberWindowPosition: _readBool(
        'rememberWindowPosition',
        defaults.rememberWindowPosition,
      ),
      lastWindowX: _readOptionalDouble('lastWindowX') ?? defaults.lastWindowX,
      lastWindowY: _readOptionalDouble('lastWindowY') ?? defaults.lastWindowY,
      lastWindowWidth:
          _readOptionalDouble('lastWindowWidth') ?? defaults.lastWindowWidth,
      lastWindowHeight:
          _readOptionalDouble('lastWindowHeight') ?? defaults.lastWindowHeight,
      similarityThreshold: _readDouble(
        'similarityThreshold',
        defaults.similarityThreshold,
      ),
      aiTemperature: _readDouble('aiTemperature', defaults.aiTemperature),
      maxTokens: _readInt('maxTokens', defaults.maxTokens),
      comparisonMode: _readString('comparisonMode', defaults.comparisonMode),
      useMicaEffect: _readBool('useMicaEffect', defaults.useMicaEffect),
      diffFontFamily: _readString('diffFontFamily', defaults.diffFontFamily),
      diffIdenticalColor:
          _readInt('diffIdenticalColor', defaults.diffIdenticalColor),
      defaultExportFormat:
          _readString('defaultExportFormat', defaults.defaultExportFormat),
      includeUtf8Bom: _readBool('includeUtf8Bom', defaults.includeUtf8Bom),
      openFolderAfterExport: _readBool(
        'openFolderAfterExport',
        defaults.openFolderAfterExport,
      ),
      autoBackup: _readBool('autoBackup', defaults.autoBackup),
      backupDirectory: _readString('backupDirectory', defaults.backupDirectory),
      backupsToKeep: _readInt('backupsToKeep', defaults.backupsToKeep),
      autoDownloadUpdate:
          _readBool('autoDownloadUpdate', defaults.autoDownloadUpdate),
      lastUpdateCheckTime: _readNullableString(
        'lastUpdateCheckTime',
        defaults.lastUpdateCheckTime,
      ),
      skipVersion: _readString('skipVersion', defaults.skipVersion),
      enableAnonymousUsageStatistics: _readBool(
        'enableAnonymousUsageStatistics',
        defaults.enableAnonymousUsageStatistics,
      ),
      enableCrashReporting:
          _readBool('enableCrashReporting', defaults.enableCrashReporting),
      showDeveloperOptions:
          _readBool('showDeveloperOptions', defaults.showDeveloperOptions),
      showPerformanceOverlay:
          _readBool('showPerformanceOverlay', defaults.showPerformanceOverlay),
      showSemanticsDebugger:
          _readBool('showSemanticsDebugger', defaults.showSemanticsDebugger),
      debugShowMaterialGrid:
          _readBool('debugShowMaterialGrid', defaults.debugShowMaterialGrid),
      checkerboardRasterCacheImages: _readBool(
        'checkerboardRasterCacheImages',
        defaults.checkerboardRasterCacheImages,
      ),
      checkerboardOffscreenLayers: _readBool(
        'checkerboardOffscreenLayers',
        defaults.checkerboardOffscreenLayers,
      ),
      debugPaintSizeEnabled: _readBool(
        'debugPaintSizeEnabled',
        defaults.debugPaintSizeEnabled,
      ),
      debugRepaintRainbowEnabled: _readBool(
        'debugRepaintRainbowEnabled',
        defaults.debugRepaintRainbowEnabled,
      ),
      showDockBadge: _readBool('showDockBadge', defaults.showDockBadge),
      macosWindowMaterial: _readString(
        'macosWindowMaterial',
        defaults.macosWindowMaterial,
      ),
      translationStrategy:
          _readString('translationStrategy', defaults.translationStrategy),
      recentProjects:
          _readStringList('recentProjects', defaults.recentProjects),
      toastPosition: _readString('toastPosition', defaults.toastPosition),
      toastStyle: _readString('toastStyle', defaults.toastStyle),
      advancedDiffUseInlineEditing: _readBool(
        'advancedDiffUseInlineEditing',
        defaults.advancedDiffUseInlineEditing,
      ),
      onboardingStep: _readInt('onboardingStep', defaults.onboardingStep),
      isOnboardingCompleted: _readBool(
        'isOnboardingCompleted',
        defaults.isOnboardingCompleted,
      ),
      showLocalizationKeys: _readBool(
        'showLocalizationKeys',
        defaults.showLocalizationKeys,
      ),
    );
  }

  // To JSON
  Map<String, dynamic> toJson() {
    return {
      'defaultSourceFormat': defaultSourceFormat,
      'defaultTargetFormat': defaultTargetFormat,
      'ignorePatterns': ignorePatterns,
      'ignoreCase': ignoreCase,
      'ignoreWhitespace': ignoreWhitespace,
      'appLanguage': appLanguage,
      'defaultViewOnStartup': defaultViewOnStartup,
      'autoCheckForUpdates': autoCheckForUpdates,
      'appThemeMode': appThemeMode,
      'accentColorValue': accentColorValue,
      'diffAddedColor': diffAddedColor,
      'diffRemovedColor': diffRemovedColor,
      'diffModifiedColor': diffModifiedColor,
      'diffFontSize': diffFontSize,
      'defaultSourceEncoding': defaultSourceEncoding,
      'defaultTargetEncoding': defaultTargetEncoding,
      'autoDetectEncoding': autoDetectEncoding,
      'csvDelimiter': csvDelimiter,
      'handleByteOrderMark': handleByteOrderMark,
      'autoReloadOnChange': autoReloadOnChange,
      'defaultExportDirectory': defaultExportDirectory,
      'aiTranslationService': aiTranslationService,
      'googleTranslateApiKey': googleTranslateApiKey,
      'deeplApiKey': deeplApiKey,
      'enableAiTranslation': enableAiTranslation,
      'translationConfidenceThreshold': translationConfidenceThreshold,
      'geminiApiKey': geminiApiKey,
      'openaiApiKey': openaiApiKey,
      'defaultAiModel': defaultAiModel,
      'systemTranslationContext': systemTranslationContext,
      'contextStringsCount': contextStringsCount,
      'includeContextStrings': includeContextStrings,
      'enableTranslationMemory': enableTranslationMemory,
      'enableFuzzyFill': enableFuzzyFill,
      'fuzzyFillMinScore': fuzzyFillMinScore,
      'fuzzyFillAutoApply': fuzzyFillAutoApply,
      'fuzzyFillOnlyEmptyTargets': fuzzyFillOnlyEmptyTargets,
      'fuzzyFillMatchLimit': fuzzyFillMatchLimit,
      'fuzzyFillExactMatchesOnly': fuzzyFillExactMatchesOnly,
      'defaultGitRepositoryPath': defaultGitRepositoryPath,
      'autoCommitOnSave': autoCommitOnSave,
      'gitUserName': gitUserName,
      'gitUserEmail': gitUserEmail,
      'enableGitIntegration': enableGitIntegration,
      'defaultBranch': defaultBranch,
      'defaultRemote': defaultRemote,
      'commitMessageTemplate': commitMessageTemplate,
      'sshKeyPath': sshKeyPath,
      'showIdenticalEntries': showIdenticalEntries,
      'startMinimizedToTray': startMinimizedToTray,
      'openLastProjectOnStartup': openLastProjectOnStartup,
      'rememberWindowPosition': rememberWindowPosition,
      'lastWindowX': lastWindowX,
      'lastWindowY': lastWindowY,
      'lastWindowWidth': lastWindowWidth,
      'lastWindowHeight': lastWindowHeight,
      'similarityThreshold': similarityThreshold,
      'comparisonMode': comparisonMode,
      'useMicaEffect': useMicaEffect,
      'diffFontFamily': diffFontFamily,
      'diffIdenticalColor': diffIdenticalColor,
      'defaultExportFormat': defaultExportFormat,
      'includeUtf8Bom': includeUtf8Bom,
      'openFolderAfterExport': openFolderAfterExport,
      'autoBackup': autoBackup,
      'backupDirectory': backupDirectory,
      'backupsToKeep': backupsToKeep,
      'aiTemperature': aiTemperature,
      'maxTokens': maxTokens,
      'autoDownloadUpdate': autoDownloadUpdate,
      'lastUpdateCheckTime': lastUpdateCheckTime,
      'skipVersion': skipVersion,
      'enableAnonymousUsageStatistics': enableAnonymousUsageStatistics,
      'enableCrashReporting': enableCrashReporting,
      'showDeveloperOptions': showDeveloperOptions,
      'showPerformanceOverlay': showPerformanceOverlay,
      'showSemanticsDebugger': showSemanticsDebugger,
      'debugShowMaterialGrid': debugShowMaterialGrid,
      'checkerboardRasterCacheImages': checkerboardRasterCacheImages,
      'checkerboardOffscreenLayers': checkerboardOffscreenLayers,
      'debugPaintSizeEnabled': debugPaintSizeEnabled,
      'debugRepaintRainbowEnabled': debugRepaintRainbowEnabled,
      'showDockBadge': showDockBadge,
      'macosWindowMaterial': macosWindowMaterial,
      'translationStrategy': translationStrategy,
      'recentProjects': recentProjects,
      'toastPosition': toastPosition,
      'toastStyle': toastStyle,
      'advancedDiffUseInlineEditing': advancedDiffUseInlineEditing,
      'onboardingStep': onboardingStep,
      'isOnboardingCompleted': isOnboardingCompleted,
      'showLocalizationKeys': showLocalizationKeys,
    };
  }

  AppSettings copyWith({
    String? defaultSourceFormat,
    String? defaultTargetFormat,
    List<String>? ignorePatterns,
    bool? ignoreCase,
    bool? ignoreWhitespace,
    String? appLanguage,
    String? defaultViewOnStartup,
    bool? autoCheckForUpdates,
    String? appThemeMode,
    int? accentColorValue,
    int? diffAddedColor,
    int? diffRemovedColor,
    int? diffModifiedColor,
    double? diffFontSize,
    String? defaultSourceEncoding,
    String? defaultTargetEncoding,
    bool? autoDetectEncoding,
    String? csvDelimiter,
    bool? handleByteOrderMark,
    bool? autoReloadOnChange,
    String? defaultExportDirectory,
    String? aiTranslationService,
    String? googleTranslateApiKey,
    String? deeplApiKey,
    bool? enableAiTranslation,
    double? translationConfidenceThreshold,
    String? geminiApiKey,
    String? openaiApiKey,
    String? defaultAiModel,
    String? systemTranslationContext,
    int? contextStringsCount,
    bool? includeContextStrings,
    bool? enableTranslationMemory,
    String? toastPosition,
    String? toastStyle,
    bool? advancedDiffUseInlineEditing,
    bool? enableFuzzyFill,
    double? fuzzyFillMinScore,
    bool? fuzzyFillAutoApply,
    bool? fuzzyFillOnlyEmptyTargets,
    int? fuzzyFillMatchLimit,
    bool? fuzzyFillExactMatchesOnly,
    String? defaultGitRepositoryPath,
    bool? autoCommitOnSave,
    String? gitUserName,
    String? gitUserEmail,
    bool? enableGitIntegration,
    String? defaultBranch,
    String? defaultRemote,
    String? commitMessageTemplate,
    String? sshKeyPath,
    bool? showIdenticalEntries,
    bool? startMinimizedToTray,
    bool? openLastProjectOnStartup,
    bool? rememberWindowPosition,
    double? lastWindowX,
    double? lastWindowY,
    double? lastWindowWidth,
    double? lastWindowHeight,
    double? similarityThreshold,
    double? aiTemperature,
    int? maxTokens,
    String? comparisonMode,
    bool? useMicaEffect,
    String? diffFontFamily,
    int? diffIdenticalColor,
    String? defaultExportFormat,
    bool? includeUtf8Bom,
    bool? openFolderAfterExport,
    bool? autoBackup,
    String? backupDirectory,
    int? backupsToKeep,
    bool? autoDownloadUpdate,
    String? lastUpdateCheckTime,
    String? skipVersion,
    bool? enableAnonymousUsageStatistics,
    bool? enableCrashReporting,
    bool? showDeveloperOptions,
    bool? showPerformanceOverlay,
    bool? showSemanticsDebugger,
    bool? debugShowMaterialGrid,
    bool? checkerboardRasterCacheImages,
    bool? checkerboardOffscreenLayers,
    bool? debugPaintSizeEnabled,
    bool? debugRepaintRainbowEnabled,
    bool? showLocalizationKeys,
    bool? showDockBadge,
    String? macosWindowMaterial,
    String? translationStrategy,
    List<String>? recentProjects,
    int? onboardingStep,
    bool? isOnboardingCompleted,
  }) {
    return AppSettings(
      defaultSourceFormat: defaultSourceFormat ?? this.defaultSourceFormat,
      defaultTargetFormat: defaultTargetFormat ?? this.defaultTargetFormat,
      ignorePatterns: ignorePatterns ?? this.ignorePatterns,
      ignoreCase: ignoreCase ?? this.ignoreCase,
      ignoreWhitespace: ignoreWhitespace ?? this.ignoreWhitespace,
      appLanguage: appLanguage ?? this.appLanguage,
      defaultViewOnStartup: defaultViewOnStartup ?? this.defaultViewOnStartup,
      autoCheckForUpdates: autoCheckForUpdates ?? this.autoCheckForUpdates,
      appThemeMode: appThemeMode ?? this.appThemeMode,
      accentColorValue: accentColorValue ?? this.accentColorValue,
      diffAddedColor: diffAddedColor ?? this.diffAddedColor,
      diffRemovedColor: diffRemovedColor ?? this.diffRemovedColor,
      diffModifiedColor: diffModifiedColor ?? this.diffModifiedColor,
      diffFontSize: diffFontSize ?? this.diffFontSize,
      defaultSourceEncoding:
          defaultSourceEncoding ?? this.defaultSourceEncoding,
      defaultTargetEncoding:
          defaultTargetEncoding ?? this.defaultTargetEncoding,
      autoDetectEncoding: autoDetectEncoding ?? this.autoDetectEncoding,
      csvDelimiter: csvDelimiter ?? this.csvDelimiter,
      handleByteOrderMark: handleByteOrderMark ?? this.handleByteOrderMark,
      autoReloadOnChange: autoReloadOnChange ?? this.autoReloadOnChange,
      defaultExportDirectory:
          defaultExportDirectory ?? this.defaultExportDirectory,
      aiTranslationService: aiTranslationService ?? this.aiTranslationService,
      googleTranslateApiKey:
          googleTranslateApiKey ?? this.googleTranslateApiKey,
      deeplApiKey: deeplApiKey ?? this.deeplApiKey,
      enableAiTranslation: enableAiTranslation ?? this.enableAiTranslation,
      translationConfidenceThreshold:
          translationConfidenceThreshold ?? this.translationConfidenceThreshold,
      geminiApiKey: geminiApiKey ?? this.geminiApiKey,
      openaiApiKey: openaiApiKey ?? this.openaiApiKey,
      defaultAiModel: defaultAiModel ?? this.defaultAiModel,
      systemTranslationContext:
          systemTranslationContext ?? this.systemTranslationContext,
      contextStringsCount: contextStringsCount ?? this.contextStringsCount,
      includeContextStrings:
          includeContextStrings ?? this.includeContextStrings,
      enableTranslationMemory:
          enableTranslationMemory ?? this.enableTranslationMemory,
      enableFuzzyFill: enableFuzzyFill ?? this.enableFuzzyFill,
      fuzzyFillMinScore: fuzzyFillMinScore ?? this.fuzzyFillMinScore,
      fuzzyFillAutoApply: fuzzyFillAutoApply ?? this.fuzzyFillAutoApply,
      fuzzyFillOnlyEmptyTargets:
          fuzzyFillOnlyEmptyTargets ?? this.fuzzyFillOnlyEmptyTargets,
      fuzzyFillMatchLimit: fuzzyFillMatchLimit ?? this.fuzzyFillMatchLimit,
      fuzzyFillExactMatchesOnly:
          fuzzyFillExactMatchesOnly ?? this.fuzzyFillExactMatchesOnly,
      defaultGitRepositoryPath:
          defaultGitRepositoryPath ?? this.defaultGitRepositoryPath,
      autoCommitOnSave: autoCommitOnSave ?? this.autoCommitOnSave,
      gitUserName: gitUserName ?? this.gitUserName,
      gitUserEmail: gitUserEmail ?? this.gitUserEmail,
      enableGitIntegration: enableGitIntegration ?? this.enableGitIntegration,
      defaultBranch: defaultBranch ?? this.defaultBranch,
      defaultRemote: defaultRemote ?? this.defaultRemote,
      commitMessageTemplate:
          commitMessageTemplate ?? this.commitMessageTemplate,
      sshKeyPath: sshKeyPath ?? this.sshKeyPath,
      showIdenticalEntries: showIdenticalEntries ?? this.showIdenticalEntries,
      startMinimizedToTray: startMinimizedToTray ?? this.startMinimizedToTray,
      openLastProjectOnStartup:
          openLastProjectOnStartup ?? this.openLastProjectOnStartup,
      rememberWindowPosition:
          rememberWindowPosition ?? this.rememberWindowPosition,
      lastWindowX: lastWindowX ?? this.lastWindowX,
      lastWindowY: lastWindowY ?? this.lastWindowY,
      lastWindowWidth: lastWindowWidth ?? this.lastWindowWidth,
      lastWindowHeight: lastWindowHeight ?? this.lastWindowHeight,
      similarityThreshold: similarityThreshold ?? this.similarityThreshold,
      aiTemperature: aiTemperature ?? this.aiTemperature,
      maxTokens: maxTokens ?? this.maxTokens,
      comparisonMode: comparisonMode ?? this.comparisonMode,
      useMicaEffect: useMicaEffect ?? this.useMicaEffect,
      diffFontFamily: diffFontFamily ?? this.diffFontFamily,
      diffIdenticalColor: diffIdenticalColor ?? this.diffIdenticalColor,
      defaultExportFormat: defaultExportFormat ?? this.defaultExportFormat,
      includeUtf8Bom: includeUtf8Bom ?? this.includeUtf8Bom,
      openFolderAfterExport:
          openFolderAfterExport ?? this.openFolderAfterExport,
      autoBackup: autoBackup ?? this.autoBackup,
      backupDirectory: backupDirectory ?? this.backupDirectory,
      backupsToKeep: backupsToKeep ?? this.backupsToKeep,
      autoDownloadUpdate: autoDownloadUpdate ?? this.autoDownloadUpdate,
      lastUpdateCheckTime: lastUpdateCheckTime ?? this.lastUpdateCheckTime,
      skipVersion: skipVersion ?? this.skipVersion,
      enableAnonymousUsageStatistics:
          enableAnonymousUsageStatistics ?? this.enableAnonymousUsageStatistics,
      enableCrashReporting: enableCrashReporting ?? this.enableCrashReporting,
      showDeveloperOptions: showDeveloperOptions ?? this.showDeveloperOptions,
      showPerformanceOverlay:
          showPerformanceOverlay ?? this.showPerformanceOverlay,
      showSemanticsDebugger:
          showSemanticsDebugger ?? this.showSemanticsDebugger,
      debugShowMaterialGrid:
          debugShowMaterialGrid ?? this.debugShowMaterialGrid,
      checkerboardRasterCacheImages:
          checkerboardRasterCacheImages ?? this.checkerboardRasterCacheImages,
      checkerboardOffscreenLayers:
          checkerboardOffscreenLayers ?? this.checkerboardOffscreenLayers,
      debugPaintSizeEnabled:
          debugPaintSizeEnabled ?? this.debugPaintSizeEnabled,
      debugRepaintRainbowEnabled:
          debugRepaintRainbowEnabled ?? this.debugRepaintRainbowEnabled,
      showDockBadge: showDockBadge ?? this.showDockBadge,
      macosWindowMaterial: macosWindowMaterial ?? this.macosWindowMaterial,
      translationStrategy: translationStrategy ?? this.translationStrategy,
      recentProjects: recentProjects ?? this.recentProjects,
      toastPosition: toastPosition ?? this.toastPosition,
      toastStyle: toastStyle ?? this.toastStyle,
      advancedDiffUseInlineEditing:
          advancedDiffUseInlineEditing ?? this.advancedDiffUseInlineEditing,
      onboardingStep: onboardingStep ?? this.onboardingStep,
      isOnboardingCompleted:
          isOnboardingCompleted ?? this.isOnboardingCompleted,
      showLocalizationKeys: showLocalizationKeys ?? this.showLocalizationKeys,
    );
  }
}
